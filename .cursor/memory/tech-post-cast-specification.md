# Tech Post Cast 仕様書

最終更新日: 2023-07-05

## サービス概要

Tech Post Cast は、Qiita の技術記事トレンドを AI で要約し、音声合成してラジオ番組風に編集して配信するサービスです。毎朝決まった時間に自動で番組を生成し、ウェブサイトや Spotify などの Podcast プラットフォームで配信しています。

## サービスで実現すること

### 現在の機能

- **AIラジオ番組の毎日自動生成と配信**
    - 毎朝7時に自動で番組を生成して配信
    - Qiita人気記事をAIのMC「ポステル」が解説
    - リスナーからのお便りを紹介

- **複数プラットフォームでの配信**
    - ウェブサイト（Nuxt3 SSG）
    - Podcast プラットフォーム（Spotify、Amazon Music、Apple Podcasts、YouTube）

- **ユーザー体験の向上**
    - チャプター機能で自由にスキップ可能
    - ラジオ番組形式での親しみやすい解説
    - BGM・効果音による番組演出

### 予定している有料機能

- **パーソナライズされたフィード**
    - 著者やタグのフォロー機能
    - 複数のフィルターの組み合わせ（ANDやOR条件）
    - フィルターグループによる条件設定

- **配信オプションのカスタマイズ**
    - 配信頻度の選択（日次、週次、記事数ベース）
    - 配信タイミングの指定（時間帯、曜日指定）
    - 優先度と緊急性の設定

- **インタラクティブなフィードバック機能**
    - 特定記事の深掘り要望への対応
    - 技術の背景・歴史など専門的な解説の提供

## ソフトウェア構成

### フロントエンド

- **技術スタック**
    - Nuxt3（SSG/SPA ハイブリッド構成）
    - Vuetify
    - TypeScript

- **機能**
    - 公開コンテンツ: SSGで生成（SEO最適化）
    - ユーザー機能（ログイン、設定画面）: SPAで実装（インタラクティブ）

### バックエンド

- **技術スタック**
    - NestJS（番組生成用バックエンド）
    - TypeScript
    - FFmpeg（音声ファイル編集・合成）
    - OpenAI API（要約、台本生成）
    - Google Cloud Text-to-Speech API（音声合成）
    - Prisma（ORM）

- **主要機能**
    - Qiita API からの人気記事取得
    - 記事の AI 要約処理
    - ラジオ番組台本の生成
    - 音声合成と編集
    - RSS フィード生成
    - 予定：ユーザー認証・課金連携

### データベース

- **構成**
    - Neon（PostgreSQL）
    - Prisma（ORM）
    - pgvector（ベクトル検索用拡張）

- **主要テーブル**
    - ヘッドライントピック番組
    - リスナーからのお便り
    - 予定：User、Subscription、FeedFilter、Schedule など

### 認証・課金（予定）

- Clerk（認証）
- Stripe（決済）

## インフラ構成

### 現在の構成

- **フロントエンド**
    - Cloudflare Pages（静的サイトホスティング）
    - Cloudflare R2（音声ファイルストレージ）

- **バックエンド**
    - AWS Lambda + Lambda Web Adapter + コンテナー
    - AWS EventBridge（スケジューリング）
    - AWS CDK（IaC）

### 予定構成（有料機能追加時）

- **フロントエンド**
    - 現状維持（Cloudflare Pages）

- **バックエンド**
    - Google Cloud Run（ユーザー向けAPIサーバー）
    - AWS Lambda または Google Cloud Functions/Run（バッチ処理）
    - Google Cloud Scheduler（ユーザーカスタムスケジュール）
    - mastra による生成AI利用

## 番組生成フロー

1. **番組で取り上げる記事のピックアップ**
   - Qiita API を使用して人気記事を取得

2. **ピックアップした記事の要約**
   - OpenAI API（GPT-4o-mini）を使用して記事を要約

3. **番組台本の生成**
   - 記事要約とリスナーからのお便りを基に台本を生成（GPT-4o）
   - MC「ポステル」のキャラクター設定に基づき台本作成

4. **音声ファイルの生成**
   - Google Cloud Text-to-Speech で台本から音声を生成
   - FFmpeg で BGM・効果音と合成、チャプター付与

5. **配信処理**
   - 番組情報とファイルをデータベースとストレージに保存
   - Cloudflare Pages をトリガーしてサイト再生成
   - RSS 更新で Podcast 番組登録
   - Twitter 投稿による告知
   - パーソナルフィードに沿った番組配信の通知は Slack（Webhook URL）でユーザーに通知する

## 拡張予定

1. **パーソナライズフィード機能**
   - ユーザー固有のフィルター設定に基づく番組生成
   - フィルターグループと条件の柔軟な組み合わせ

2. **配信カスタマイズ**
   - 配信頻度・タイミングのユーザー設定
   - プッシュ通知機能

3. **料金プラン**
   - Free: パーソナルフィード設定は1つだけ。設定できる著者・タグ数は限定的
   - Premium: 複数のパーソナルフィード設定、Free プランよりも多くの著者・タグ数を設定できる
   - Business: 無制限フィルター、優先配信、多数の深掘りリクエスト、チーム共有機能

## 不明点と確認事項

- 現在のユーザー数と利用状況の詳細
    - LP には週に25ユーザーほどがアクセスしています
    - 各 Podcast サービスは不明です
- 有料機能のリリース予定時期
    - パーソナルフィードに基づいた番組（パーソナルプログラム）では、現在のヘッドライントピック番組に比べ、記事の要点に沿った解説をするように変更中
    - 5月中に、先行ユーザーに Premium プランを招待して利用できるようにする
    - Business プランの提供は未定です
- パーソナライズフィード機能の詳細な優先順位
    - 一番の優先事項です
- 将来的なコンテンツソース拡大の可能性（Qiita以外のプラットフォーム対応）
    - パーソナルフィードでのフィルター設定をできる API があるプラットフォームを見つけられれば拡張したい
