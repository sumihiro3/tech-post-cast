# データベーススキーマ設計の洞察と発見

## パーソナルプログラムと記事の関連性 (2023-07-25)

### 初期検討事項と再考

**初期考察:**
- 当初、パーソナルプログラムで紹介する記事には以下の追加情報が必要と考えた:
  - 関連性スコア: 記事とパーソナルフィードの関連度
  - 言及時間情報: プログラム内で記事が言及されたタイムスタンプ
  - 専用の中間テーブル: これらメタデータを保存するための明示的なテーブル

**再考後の結論:**
- 既存のテーブル構成（`QiitaPost`と`PersonalizedFeedProgram`の多対多関連）で十分
- パーソナルフィード条件（著者、タグ、いいね数、公開日範囲）に基づいて記事が選別されるため、関連性スコアは不要
- 言及時間はプログラム生成日時（`createdAt`）で代用可能
- Prismaの自動生成される中間テーブルで十分であり、明示的な中間テーブルは不要

### 学んだ教訓

1. **機能要件の正確な理解の重要性:**
   - データモデルを設計する前に、実際の機能要件と利用パターンを深く理解することが重要
   - 単に「こういうデータがあるべき」ではなく「このデータがどう使われるか」を考慮する

2. **既存の構造の活用:**
   - 新しいテーブルやカラムを追加する前に、既存のデータ構造で要件を満たせないか検討する
   - 多対多関連などのORM機能を活用することで、明示的な中間テーブルが不要になる場合も多い

3. **過剰設計の回避:**
   - 「将来必要かもしれない」という理由だけでデータモデルを複雑化しない
   - 実際に必要になった時点で拡張することも選択肢として考慮する

## 今後のデータモデル変更時の注意点

1. **要件確認のチェックリスト:**
   - そのデータは実際にどのように使用されるか？
   - 既存のモデルで満たせないか？
   - 性能への影響は？（新しいインデックスやテーブルが必要か）
   - 既存データとの互換性は？（マイグレーション戦略）

2. **マイグレーション計画:**
   - 必ずテスト環境でマイグレーションをテスト
   - 本番データへの影響を最小限にする戦略を立てる
   - ロールバック計画を必ず用意する
