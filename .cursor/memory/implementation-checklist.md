# 実装時のチェックリスト

## 新機能実装前の確認事項

### アーキテクチャ設計 (2024-12-19更新)

- [ ] **3層アーキテクチャの確認**
    - [ ] Controller → Service → Repository の流れになっているか
    - [ ] ControllerがRepositoryを直接呼び出していないか
    - [ ] ビジネスロジックがServiceに配置されているか

- [ ] **類似機能の調査**
    - [ ] 同じアプリケーション内に類似のService/Repositoryが存在するか
    - [ ] 他のアプリケーション（api-backend/backend）での実装パターンを確認したか
    - [ ] 既存の命名規則に従っているか

- [ ] **データ設計の確認**
    - [ ] 統計データは単一の真実の源泉（データベース）から取得しているか
    - [ ] 外部システムからのデータ受け渡しに過度に依存していないか
    - [ ] 全ての可能なステータス（SUCCESS/SKIPPED/FAILED等）を考慮しているか

### 実装時の確認事項

#### DTO設計

- [ ] **バリデーション**
    - [ ] 必要なバリデーションデコレータが設定されているか
    - [ ] オプショナルパラメータに適切なデフォルト値が設定されているか

- [ ] **日付処理**
    - [ ] 日付計算ロジックがDTOまたはServiceに配置されているか
    - [ ] タイムゾーンが適切に考慮されているか

#### Service実装

- [ ] **依存性注入**
    - [ ] 必要なRepositoryが適切に注入されているか
    - [ ] Moduleのprovidersに新しいServiceが追加されているか

- [ ] **ビジネスロジック**
    - [ ] 単一責任の原則に従っているか
    - [ ] 複雑な計算処理がprivateメソッドに分離されているか

#### Repository実装

- [ ] **データアクセス**
    - [ ] ビジネスロジックが含まれていないか
    - [ ] Prismaクエリが適切に実装されているか

### エラーハンドリングとメッセージング

- [ ] **ステータス管理**
    - [ ] 全ての業務ステータスが適切に処理されているか
    - [ ] エラー詳細情報が必要な場合のみ保持されているか

- [ ] **通知メッセージ**
    - [ ] ユーザーに分かりやすい形で情報が提供されているか
    - [ ] 業務的な意味が正確に反映されているか

### テスト実装

- [ ] **ユニットテスト**
    - [ ] 新しいServiceのテストが追加されているか
    - [ ] テストデータはファクトリクラスから取得しているか
    - [ ] 全ての分岐パターンがテストされているか

- [ ] **統合テスト**
    - [ ] Controller-Service-Repository の連携がテストされているか
    - [ ] エラーケースのテストが含まれているか

## 実装後の確認事項

### コード品質

- [ ] **リファクタリング**
    - [ ] 重複コードが除去されているか
    - [ ] 適切な抽象化が行われているか

- [ ] **パフォーマンス**
    - [ ] 不要なデータベースアクセスがないか
    - [ ] N+1問題が発生していないか

### ドキュメント更新

- [ ] **API仕様**
    - [ ] OpenAPI仕様が更新されているか
    - [ ] 新しいエンドポイントの説明が追加されているか

- [ ] **実装記録**
    - [ ] アーキテクチャ決定記録が更新されているか
    - [ ] 学んだ教訓が記録されているか

## 共通化の検討事項 (2024-12-19追加)

### モノレポでの一貫性

- [ ] **アプリケーション間の整合性**
    - [ ] 類似機能の実装パターンが統一されているか
    - [ ] 共通化すべきロジックが特定されているか

- [ ] **段階的共通化**
    - [ ] 過度な共通化を避けているか
    - [ ] 必要に応じて将来の共通化を考慮した設計になっているか

### 将来の拡張性

- [ ] **インターフェース設計**
    - [ ] 将来の機能拡張を考慮した構造になっているか
    - [ ] 破壊的変更を避けられる設計になっているか
