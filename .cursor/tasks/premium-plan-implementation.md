# プレミアムプラン実装タスク計画書

## 概要

パーソナルプログラム機能をベースに、Premiumプランの実装に関連する一連のタスクを整理します。

## コンテンツ管理タスク

### パーソナルプログラムや紹介Qiita記事の永続化

- **優先度**: P1
- **状態**: 未着手
- **期限**: 未設定
- **説明**: パーソナルプログラムで紹介したQiita記事の情報を永続化し、ユーザーが後から参照できるようにする
- **依存関係**: なし
- **サブタスク**:
    1. 紹介記事テーブル設計（articles, program_articles など）
    2. 記事情報永続化処理の実装
    3. 記事永続化のテスト
    4. ユーザー向け記事履歴表示APIの実装

## 定期実行関連タスク

### パーソナルプログラム生成の定期実行仕組み検討

- **優先度**: P1
- **状態**: 未着手
- **期限**: 未設定
- **説明**: プレミアムユーザー向けに定期的にパーソナルプログラムを生成する仕組みを検討
- **依存関係**: なし
- **サブタスク**:
    1. 定期実行アーキテクチャの検討（AWS Lambda + EventBridge, NestJS Scheduled Tasks など）
    2. スケジューリング方式の決定（固定時間実行、ユーザー設定可能など）
    3. エラーハンドリングとリトライ戦略の検討
    4. リソース消費と制限の分析

### パーソナルプログラム生成の定期実行機能の実装

- **優先度**: P1
- **状態**: 未着手
- **期限**: 未設定
- **説明**: 検討結果に基づいて定期実行機能を実装
- **依存関係**: パーソナルプログラム生成の定期実行仕組み検討
- **サブタスク**:
    1. 定期実行基盤の実装
    2. ユーザーの購読状態チェック処理の実装
    3. バッチ処理でのプログラム生成機能の実装
    4. スケジューリング設定のユーザーインターフェイス実装（必要に応じて）
    5. 定期実行ログの記録と監視

## 課金関連タスク

### Stripeでの課金モデル検討

- **優先度**: P0
- **状態**: 未着手
- **期限**: 未設定
- **説明**: Premiumプランの料金体系や課金サイクルなどを検討
- **依存関係**: なし
- **サブタスク**:
    1. 料金プラン設計（月額/年額、複数プラン比較など）
    2. 課金サイクルと更新ポリシーの決定
    3. トライアル期間の検討
    4. 決済失敗時の対応フローの設計

### ユーザー課金関連データベース設計

- **優先度**: P0
- **状態**: 未着手
- **期限**: 未設定
- **説明**: ユーザーの課金状況や課金履歴を管理するテーブル構成の検討
- **依存関係**: Stripeでの課金モデル検討
- **サブタスク**:
    1. 課金関連テーブル設計（subscriptions, payment_history など）
    2. 既存ユーザーテーブルとの関連設計
    3. Stripe顧客IDなど外部サービス連携情報の管理設計
    4. 課金状態に関するインデックス最適化

### Stripe導入実装

- **優先度**: P0
- **状態**: 未着手
- **期限**: 未設定
- **説明**: Stripeを使った課金システムの実装
- **依存関係**: ユーザー課金関連データベース設計
- **サブタスク**:
    1. Stripe SDK/APIの導入
    2. 決済ページフローの実装
    3. Webhookハンドラー実装
    4. 支払い成功/失敗時の処理実装
    5. 請求書生成と管理機能
    6. 決済テスト環境の構築

## 追加推奨タスク

### プレミアム機能アクセス制御

- **優先度**: P1
- **状態**: 未着手
- **期限**: 未設定
- **説明**: プレミアム機能へのアクセス制限と権限管理の実装
- **依存関係**: ユーザー課金関連データベース設計
- **サブタスク**:
    1. 認証・認可フローへのサブスクリプション状態チェック追加
    2. APIエンドポイントへのプレミアムガード実装
    3. フロントエンドでのプレミアム機能表示制御
    4. 購読期限切れ時の対応処理

### ユーザー管理機能拡張

- **優先度**: P2
- **状態**: 未着手
- **期限**: 未設定
- **説明**: サブスクリプション管理や変更のためのユーザー機能拡張
- **依存関係**: Stripe導入実装
- **サブタスク**:
    1. サブスクリプション管理UI実装
    2. プラン変更・キャンセルフロー実装
    3. 支払い方法更新機能実装
    4. 課金履歴表示機能実装

### サブスクリプション分析とレポート

- **優先度**: P3
- **状態**: 未着手
- **期限**: 未設定
- **説明**: サブスクリプション状況の分析とレポート機能
- **依存関係**: Stripe導入実装、 ユーザー課金関連データベース設計
- **サブタスク**:
    1. 課金状況のダッシュボード実装
    2. 収益推移グラフ機能
    3. ユーザー継続率分析
    4. コホート分析機能
