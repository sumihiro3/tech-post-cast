# Nuxt 3 LPフロントエンド実装ルール

**適用対象**: apps/lp-frontend/**/*

Tech Post Cast LPフロントエンド実装ルール

## フレームワーク・ライブラリ

Nuxt 3 + Vuetify + TypeScript で実装してください
Nuxt設定はnuxt.config.tsに集約し、不要な設定は追加しないでください

## コンポーネント設計

### 基本原則

- ファイル名はPascalCaseで命名してください (例: TopHero.vue)
- コンポーネントはsrc/componentsディレクトリに配置してください
- 関連性のあるコンポーネントはサブディレクトリにまとめてください (例: components/hero/)
- コンポーネントはTypeScriptのSetup Scriptで実装してください
- テンプレートはPugを使用してください
- スタイルはSCSSまたはCSSを使用してください
- Props、Emits、Ref等の型は明示的に指定してください

### 共通コンポーネントの配置と命名規則

- **共通コンポーネント**: `src/components/common/`に配置し、`App`プレフィックスを付けてください
    - 例: `AppSnackbar.vue`, `AppProgress.vue`, `AppHeader.vue`
- **ページ固有コンポーネント**: `src/components/[page-name]/`に配置してください
- **UI部品コンポーネント**: `src/components/ui/`は使用せず、共通コンポーネントまたはページ固有コンポーネントとして配置してください

### コンポーネント分割戦略

- **ページレベル**: フォーム全体とアクションボタンはページレベルで実装し、状態管理を一元化してください
- **UIコンポーネント**: 再利用可能なUIパーツのみを分離し、emit/propsの複雑な連鎖を避けてください
- **適度な分割**: 過度な分割は避け、保守性と再利用性のバランスを考慮してください

### Nuxt 3 自動インポート対応

- コンポーネントの自動インポートを活用し、明示的なインポートは避けてください
- `.nuxt/components.d.ts`で生成される名前を確認し、テンプレートで正しい名前を使用してください
- ディレクトリ構造に基づく命名規則を理解してください（例: `components/dashboard/settings/UserNameSection.vue` → `DashboardSettingsUserNameSection`）

### Vue 3 Composition API 対応

- `emit`は戻り値を返さないため、子コンポーネントから親の非同期関数の結果を直接受け取ることはできません
- 非同期処理の結果が必要な場合は、propsで関数を渡すか、状態を親で管理してください

## スタイリング

- Vuetifyのコンポーネントを優先的に使用してください
- カスタムCSSはscoped属性を付与してください
- 色やサイズなどの変数はVuetifyのテーマ設定を使用してください
- レスポンシブデザインはVuetifyのブレークポイントを使用してください

## 状態管理

### 基本方針

- ページレベルの状態はページコンポーネント内で管理してください
- 複数のコンポーネント間で共有する状態はcomposablesに切り出してください
- APIとの通信はsrc/apiディレクトリに実装してください
- 環境変数はruntimeConfigを介してアクセスしてください

### Composables設計

- **API連携用**: `useXxxApi`形式で命名し、CRUD操作と状態管理を含めてください
- **機能特化型**: `useXxxFeature`形式で特定機能（例: `useSlackWebhookTest`）を実装してください
- **状態管理**: `settings`, `originalSettings`, `loading`, `error`, `hasChanges`などの標準的な状態を含めてください
- **バリデーション**: フロントエンド側でのリアルタイムバリデーション機能を含めてください

### UI状態管理の統一ルール

**必須**: UI状態管理には`useUIState`composableを使用してください

```typescript
// ✅ 推奨: 統一されたUI状態管理
const ui = useUIState();
ui.showLoading({ message: '処理中...' });
ui.showSuccess('保存しました');
ui.showError('エラーが発生しました');

// ❌ 非推奨: 個別のcomposableの直接使用
const snackbar = useSnackbar();
const progress = useProgress();
```

#### UI状態管理のベストプラクティス

1. **統一インターフェースの使用**
   - `useUIState`を通じてすべてのUI状態を管理してください
   - 個別のcomposable（`useSnackbar`, `useProgress`）の直接使用は避けてください

2. **共通コンポーネントの活用**
   - `AppSnackbar`と`AppProgress`をレイアウトファイルに配置してください
   - これらのコンポーネントは`useUIState`と自動的に連携します

3. **型安全性の確保**
   - すべてのUI状態関連の関数には明示的な戻り値型を指定してください
   - linterエラーは完全に解消してから実装を完了してください

4. **段階的移行**
   - 既存のコードを一度に変更せず、段階的に`useUIState`に移行してください
   - 既存の動作するコードは可能な限り活用してください

## API連携

### 基本設定

- src/apiディレクトリはバックエンドのOpenAPI定義から自動生成されています
- 自動生成されたコードは直接編集せず、必要に応じてラッパーを作成してください
- APIクライアントの初期化と認証トークンの設定はプラグインで行ってください

### エラーハンドリング

- **詳細なエラー情報**: HTTPステータス、サーバーエラーメッセージを含む詳細な情報を表示してください
- **ユーザーフレンドリー**: 技術的なエラーメッセージをユーザーが理解しやすい形に変換してください
- **自動クリア**: 成功時にエラーメッセージを自動的にクリアしてください
- **エラー状態管理**: composablesでエラー状態を適切に管理してください

### APIクライアント更新

- バックエンドのAPI定義更新時は`yarn generate:api-client`を実行してください
- 生成されたAPIクライアントをプラグインに追加してください
- 型定義の変更に合わせてcomposablesを更新してください

## 型定義

- 共通の型定義はsrc/typesディレクトリに配置してください
- ドメイン固有の型定義は適切なサブディレクトリに配置してください (例: types/headline-topic-programs/)
- any型の使用は避け、適切な型を定義してください
- APIレスポンスの型はDtoサフィックスを付けてください
- 自動生成されたAPIの型定義は修正せず、必要に応じてラッパー型を定義してください

### Composableの型定義ルール

1. **戻り値型の明示**

   ```typescript
   // ✅ 推奨: 明示的な戻り値型
   export const useUIState = (): UIStateReturn => {
     // 実装
   };

   // ❌ 非推奨: 型推論に依存
   export const useUIState = () => {
     // 実装
   };
   ```

2. **インターフェースの定義**

   ```typescript
   interface UIStateReturn {
     showLoading: (options?: LoadingOptions) => void;
     hideLoading: () => void;
     showSuccess: (message: string, options?: MessageOptions) => void;
     // ...
   }
   ```

## Composable設計ルール

### 統一インターフェースパターン

複数の関連するcomposableがある場合は、統一インターフェースを提供してください：

```typescript
// 統一インターフェース
export const useUIState = (): UIStateReturn => {
  const snackbar = useSnackbar(); // 既存composableを活用
  const progress = useProgress();  // 既存composableを活用

  return {
    // 統一されたAPI
    showLoading: (options?: LoadingOptions): void => progress.show(options),
    showSuccess: (message: string, options?: MessageOptions): void =>
      snackbar.showSuccess(message, options),
  };
};
```

### 既存資産活用の原則

1. **段階的統一化**: 既存の動作するcomposableは削除せず、上位レイヤーで統一してください
2. **後方互換性**: 既存のAPIを破壊せずに新しいAPIを提供してください
3. **文書化**: 統一インターフェースの使用方法をREADMEで明確に説明してください

## フォーム実装

### バリデーション

- **リアルタイムバリデーション**: ユーザー入力に対してリアルタイムでフィードバックを提供してください
- **文字数制限**: 制限がある場合は文字数カウンターを表示してください
- **URL形式チェック**: URLフィールドでは適切な形式チェックを実装してください
- **条件付きバリデーション**: 他のフィールドの状態に応じたバリデーションを実装してください

### 状態管理

- **変更検知**: 未保存の変更を検知し、適切にボタンの有効/無効を制御してください
- **リセット機能**: 最後に保存された状態に戻すリセット機能を提供してください
- **自動保存**: 必要に応じて自動保存機能を検討してください

## UI/UX設計

### レスポンシブデザイン

- モバイルファースト設計を採用してください
- Vuetifyのブレークポイント（xs, sm, md, lg, xl）を活用してください
- ボタン配置やフォームレイアウトをデバイスサイズに応じて最適化してください

### アクセシビリティ

- キーボード操作で全機能にアクセス可能にしてください
- 適切なaria-label、aria-describedbyを設定してください
- 色覚対応として、色以外の情報でも状態を判別可能にしてください
- スクリーンリーダー対応を考慮してください

### ユーザビリティ

- **保存ボタン位置**: フォーム下部など、ユーザーが期待する位置に配置してください
- **フィードバック**: 操作結果を明確にユーザーに伝えてください
- **プログレス表示**: 長時間の処理では適切なローディング表示を行ってください

## パフォーマンス最適化

- 大きなコンポーネントは適切に分割してください
- 画像は最適化してから使用してください
- 不要なレンダリングを避けるためにv-memoやv-onceを活用してください
- ルートごとに適切なレンダリング戦略を使用してください (SSG, SSR, CSR)

## テスト

### テスト戦略

- 新機能追加時はユニットテストを作成してください
- コンポーネントのロジックはできるだけcomposablesに分離し、テスト可能にしてください
- **テストデータ**: 必ずファクトリクラスから取得してください（統一テスト戦略に準拠）

### テスト対象

- **Composables**: API連携、状態管理、バリデーション機能
- **コンポーネント**: ユーザーインタラクション、プロパティ変更時の動作
- **統合テスト**: フォーム送信、画面遷移、API連携

## デバッグ・トラブルシューティング

### よくある問題と解決方法

1. **コンポーネントが見つからないエラー**
   - `.nuxt/components.d.ts`で自動生成された名前を確認
   - ディレクトリ構造に基づく命名規則を確認

2. **emit関数の戻り値エラー**
   - Vue 3では`emit`は戻り値を返さない
   - 非同期処理の結果が必要な場合はpropsで関数を渡す

3. **APIクライアントの型エラー**
   - `yarn generate:api-client`でクライアントを再生成
   - バックエンドのAPI定義との整合性を確認

4. **バリデーションエラー**
   - フロントエンドとバックエンドのバリデーション仕様を統一
   - 空文字やnullの扱いを明確に定義

## アクセシビリティ

- セマンティックなHTMLを使用してください
- 適切なARIAロールと属性を使用してください
- コントラスト比を考慮した色設計を行ってください
- キーボード操作に対応してください

## SEO対策

- 各ページには適切なtitle, description, OGP設定を含めてください
- 構造化データを適切に設定してください
- 画像にはalt属性を設定してください

## リンター・フォーマッター

- ESLintのルールにしたがってコードを記述してください
- コードフォーマットはnpm run formatコマンドで整形してください
- コミット前に必ずlintチェックを実行してください

## 実装例・ベストプラクティス

### ユーザー設定画面の実装例

今回実装したユーザー設定画面（`pages/app/settings.vue`）は、以下のベストプラクティスを実装しています：

- **適度なコンポーネント分割**: UIコンポーネントのみ分離し、状態管理はページレベルで一元化
- **詳細なエラーハンドリング**: HTTPステータスとサーバーメッセージを含む詳細な情報表示
- **リアルタイムバリデーション**: ユーザー入力に対する即座のフィードバック
- **レスポンシブデザイン**: モバイル・タブレット・デスクトップ対応
- **アクセシビリティ対応**: キーボード操作とスクリーンリーダー対応

この実装を参考に、他の画面でも同様の品質を保ってください。
